/* @license GNU-GPL-2.0-or-later https://www.drupal.org/licensing/faq */
(function(_,$,Drupal,drupalSettings){'use strict';var Bootstrap={processedOnce:{},settings:drupalSettings.bootstrap||{}};Bootstrap.checkPlain=function(str){return str&&Drupal.checkPlain(str)||'';};Bootstrap.createPlugin=function(id,plugin,noConflict){if($.fn[id]!==void 0)return this.fatal('Specified jQuery plugin identifier already exists: @id. Use Drupal.bootstrap.replacePlugin() instead.',{'@id':id});if(typeof plugin!=='function')return this.fatal('You must provide a constructor function to create a jQuery plugin "@id": @plugin',{'@id':id,'@plugin':plugin});this.pluginNoConflict(id,plugin,noConflict);$.fn[id]=plugin;};Bootstrap.diffObjects=function(objects){var args=Array.prototype.slice.call(arguments);return _.pick(args[0],_.difference.apply(_,_.map(args,function(obj){return Object.keys(obj);})));};Bootstrap.eventMap={Event:/^(?:load|unload|abort|error|select|change|submit|reset|focus|blur|resize|scroll)$/,MouseEvent:/^(?:click|dblclick|mouse(?:down|enter|leave|up|over|move|out))$/,KeyboardEvent:/^(?:key(?:down|press|up))$/,TouchEvent:/^(?:touch(?:start|end|move|cancel))$/};Bootstrap.extendPlugin=function(id,callback){if(typeof $.fn[id]!=='function')return this.fatal('Specified jQuery plugin identifier does not exist: @id',{'@id':id});if(typeof callback!=='function')return this.fatal('You must provide a callback function to extend the jQuery plugin "@id": @callback',{'@id':id,'@callback':callback});var constructor=$.fn[id]&&$.fn[id].Constructor||$.fn[id];var plugin=callback.apply(constructor,[this.settings]);if(!$.isPlainObject(plugin))return this.fatal('Returned value from callback is not a plain object that can be used to extend the jQuery plugin "@id": @obj',{'@obj':plugin});this.wrapPluginConstructor(constructor,plugin,true);return $.fn[id];};Bootstrap.superWrapper=function(parent,fn){return function(){var previousSuper=this.super;this.super=parent;var ret=fn.apply(this,arguments);if(previousSuper)this.super=previousSuper;else delete this.super;return ret;};};Bootstrap.fatal=function(message,args){if(this.settings.dev&&console.warn){for(var name in args)if(args.hasOwnProperty(name)&&typeof args[name]==='object')args[name]=JSON.stringify(args[name]);Drupal.throwError(new Error(Drupal.formatString(message,args)));}return false;};Bootstrap.intersectObjects=function(objects){var args=Array.prototype.slice.call(arguments);return _.pick(args[0],_.intersection.apply(_,_.map(args,function(obj){return Object.keys(obj);})));};Bootstrap.normalizeObject=function(obj){if(!$.isPlainObject(obj))return obj;for(var k in obj)if(typeof obj[k]==='string')if(obj[k]==='true')obj[k]=true;else if(obj[k]==='false')obj[k]=false;else{if(obj[k].match(/^[\d-.]$/))obj[k]=parseFloat(obj[k]);}else{if($.isPlainObject(obj[k]))obj[k]=Bootstrap.normalizeObject(obj[k]);}return obj;};Bootstrap.once=function(id,callback){if(this.processedOnce[id])return this;callback.call(this,this.settings);this.processedOnce[id]=true;return this;};Bootstrap.option=function(key,value){var options=$.isPlainObject(key)?$.extend({},key):{};if(arguments.length===0)return $.extend({},this.options);if(typeof key==="string"){var parts=key.split('.');key=parts.shift();var obj=options;if(parts.length){for(var i=0;i<parts.length-1;i++){obj[parts[i]]=obj[parts[i]]||{};obj=obj[parts[i]];}key=parts.pop();}if(arguments.length===1)return obj[key]===void 0?null:obj[key];obj[key]=value;}$.extend(true,this.options,options);};Bootstrap.pluginNoConflict=function(id,plugin,noConflict){if(plugin.noConflict===void 0&&(noConflict===void 0||noConflict)){var old=$.fn[id];plugin.noConflict=function(){$.fn[id]=old;return this;};}};Bootstrap.relayEvent=function(target,name,stopPropagation){return function(e){if(stopPropagation===void 0||stopPropagation)e.stopPropagation();var $target=$(target);var parts=name.split('.').filter(Boolean);var type=parts.shift();e.target=$target[0];e.currentTarget=$target[0];e.namespace=parts.join('.');e.type=type;$target.trigger(e);};};Bootstrap.replacePlugin=function(id,callback,noConflict){if(typeof $.fn[id]!=='function')return this.fatal('Specified jQuery plugin identifier does not exist: @id',{'@id':id});if(typeof callback!=='function')return this.fatal('You must provide a valid callback function to replace a jQuery plugin: @callback',{'@callback':callback});var constructor=$.fn[id]&&$.fn[id].Constructor||$.fn[id];var plugin=callback.apply(constructor,[this.settings]);if(typeof plugin!=='function')return this.fatal('Returned value from callback is not a usable function to replace a jQuery plugin "@id": @plugin',{'@id':id,'@plugin':plugin});this.wrapPluginConstructor(constructor,plugin);this.pluginNoConflict(id,plugin,noConflict);$.fn[id]=plugin;};Bootstrap.simulate=function(element,type,options){var ret=true;if(element instanceof $){element.each(function(){if(!Bootstrap.simulate(this,type,options))ret=false;});return ret;}if(!(element instanceof HTMLElement))this.fatal('Passed element must be an instance of HTMLElement, got "@type" instead.',{'@type':typeof element});if(typeof $.simulate==='function'){new $.simulate(element,type,options);return true;}var event;var ctor;var types=[].concat(type);for(var i=0,l=types.length;i<l;i++){type=types[i];for(var name in this.eventMap)if(this.eventMap[name].test(type)){ctor=name;break;}if(!ctor)throw new SyntaxError('Only rudimentary HTMLEvents, KeyboardEvents and MouseEvents are supported: '+type);var opts={bubbles:true,cancelable:true};if(ctor==='KeyboardEvent'||ctor==='MouseEvent')$.extend(opts,{ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1});if(ctor==='MouseEvent')$.extend(opts,{button:0,pointerX:0,pointerY:0,view:window});if(options)$.extend(opts,options);if(typeof window[ctor]==='function'){event=new window[ctor](type,opts);if(!element.dispatchEvent(event))ret=false;}else if(document.createEvent){event=document.createEvent(ctor);event.initEvent(type,opts.bubbles,opts.cancelable);if(!element.dispatchEvent(event))ret=false;}else if(typeof element.fireEvent==='function'){event=$.extend(document.createEventObject(),opts);if(!element.fireEvent('on'+type,event))ret=false;}else{if(typeof element[type])element[type]();}}return ret;};Bootstrap.stripHtml=function(html){if(html instanceof $)html=html.html();else{if(html instanceof Element)html=html.innerHTML;}var tmp=document.createElement('DIV');tmp.innerHTML=html;return (tmp.textContent||tmp.innerText||'').replace(/^[\s\n\t]*|[\s\n\t]*$/,'');};Bootstrap.unsupported=function(type,name,value){Bootstrap.warn('Unsupported by Drupal Bootstrap: (@type) @name -> @value',{'@type':type,'@name':name,'@value':typeof value==='object'?JSON.stringify(value):value});};Bootstrap.warn=function(message,args){if(this.settings.dev&&console.warn)console.warn(Drupal.formatString(message,args));};Bootstrap.wrapPluginConstructor=function(constructor,plugin,extend){var proto=constructor.prototype;var option=this.option;if(proto.option===void (0))proto.option=function(){return option.apply(this,arguments);};if(extend){if(plugin.prototype!==void 0)for(var key in plugin.prototype){if(!plugin.prototype.hasOwnProperty(key))continue;var value=plugin.prototype[key];if(typeof value==='function')proto[key]=this.superWrapper(proto[key]||function(){},value);else proto[key]=$.isPlainObject(value)?$.extend(true,{},proto[key],value):value;}delete plugin.prototype;for(key in plugin){if(!plugin.hasOwnProperty(key))continue;value=plugin[key];if(typeof value==='function')constructor[key]=this.superWrapper(constructor[key]||function(){},value);else constructor[key]=$.isPlainObject(value)?$.extend(true,{},constructor[key],value):value;}}};Drupal.bootstrap=Drupal.bootstrap||Bootstrap;})(window._,window.jQuery,window.Drupal,window.drupalSettings);;
(function($,_){var Attributes=function(attributes){this.data={};this.data['class']=[];this.merge(attributes);};Attributes.prototype.toString=function(){var output='';var name,value;var checkPlain=function(str){return str&&str.toString().replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/</g,'&lt;').replace(/>/g,'&gt;')||'';};var data=this.getData();for(name in data){if(!data.hasOwnProperty(name))continue;value=data[name];if(_.isFunction(value))value=value();if(_.isObject(value))value=_.values(value);if(_.isArray(value))value=value.join(' ');output+=' '+checkPlain(name)+'="'+checkPlain(value)+'"';}return output;};Attributes.prototype.toPlainObject=function(){var object={};var name,value;var data=this.getData();for(name in data){if(!data.hasOwnProperty(name))continue;value=data[name];if(_.isFunction(value))value=value();if(_.isObject(value))value=_.values(value);if(_.isArray(value))value=value.join(' ');object[name]=value;}return object;};Attributes.prototype.addClass=function(value){var args=Array.prototype.slice.call(arguments);this.data['class']=this.sanitizeClasses(this.data['class'].concat(args));return this;};Attributes.prototype.exists=function(name){return this.data[name]!==void (0)&&this.data[name]!==null;};Attributes.prototype.get=function(name,defaultValue){if(!this.exists(name))this.data[name]=defaultValue;return this.data[name];};Attributes.prototype.getData=function(){return _.extend({},this.data);};Attributes.prototype.getClasses=function(){return this.get('class',[]);};Attributes.prototype.hasClass=function(className){className=this.sanitizeClasses(Array.prototype.slice.call(arguments));var classes=this.getClasses();for(var i=0,l=className.length;i<l;i++)if(_.indexOf(classes,className[i])===-1)return false;return true;};Attributes.prototype.merge=function(object,recursive){if(!object)return this;if(object instanceof $)object=object[0];if(object instanceof Node)object=Array.prototype.slice.call(object.attributes).reduce(function(attributes,attribute){attributes[attribute.name]=attribute.value;return attributes;},{});else if(object instanceof Attributes)object=object.getData();else object=_.extend({},object);if(!$.isPlainObject(object)){setTimeout(function(){throw new Error('Passed object is not supported: '+object);});return this;}if(object&&object['class']!==void 0){this.addClass(object['class']);delete object['class'];}if(recursive===void 0||recursive)this.data=$.extend(true,{},this.data,object);else this.data=$.extend({},this.data,object);return this;};Attributes.prototype.remove=function(name){if(this.exists(name))delete this.data[name];return this;};Attributes.prototype.removeClass=function(className){var remove=this.sanitizeClasses(Array.prototype.slice.apply(arguments));this.data['class']=_.without(this.getClasses(),remove);return this;};Attributes.prototype.replaceClass=function(oldValue,newValue){var classes=this.getClasses();var i=_.indexOf(this.sanitizeClasses(oldValue),classes);if(i>=0){classes[i]=newValue;this.set('class',classes);}return this;};Attributes.prototype.sanitizeClasses=function(classes){return _.chain(Array.prototype.slice.call(arguments)).flatten().map(function(string){return string.split(' ');}).flatten().filter().map(function(value){return Attributes.cleanClass(value);}).uniq().value();};Attributes.prototype.set=function(name,value){var obj=$.isPlainObject(name)?name:{};if(typeof name==='string')obj[name]=value;return this.merge(obj);};Attributes.cleanClass=function(identifier,filter){filter=filter||{' ':'-','_':'-','/':'-','[':'-',']':''};identifier=identifier.toLowerCase();if(filter['__']===void 0)identifier=identifier.replace('__','#DOUBLE_UNDERSCORE#');identifier=identifier.replace(Object.keys(filter),Object.keys(filter).map(function(key){return filter[key];}));if(filter['__']===void 0)identifier=identifier.replace('#DOUBLE_UNDERSCORE#','__');identifier=identifier.replace(/[^\u002D\u0030-\u0039\u0041-\u005A\u005F\u0061-\u007A\u00A1-\uFFFF]/g,'');identifier=identifier.replace(['/^[0-9]/','/^(-[0-9])|^(--)/'],['_','__']);return identifier;};Attributes.create=function(attributes){return new Attributes(attributes);};window.Attributes=Attributes;})(window.jQuery,window._);;
(function($,Drupal,Bootstrap,Attributes){if(!Drupal.icon)Drupal.icon={bundles:{}};if(!Drupal.theme.icon||Drupal.theme.prototype.icon)$.extend(Drupal.theme,{icon:function(bundle,icon,attributes){if(!Drupal.icon.bundles[bundle])return '';attributes=Attributes.create(attributes).addClass('icon').set('aria-hidden','true');icon=Drupal.icon.bundles[bundle](icon,attributes);return '<span'+attributes+'></span>';}});Drupal.icon.bundles.bootstrap=function(icon,attributes){attributes.addClass(['glyphicon','glyphicon-'+icon]);};$.extend(Drupal.theme,{ajaxThrobber:function(){return Drupal.theme('bootstrapIcon','refresh',{'class':['ajax-throbber','glyphicon-spin']});},button:function(attributes){attributes=Attributes.create(attributes).addClass('btn');var context=attributes.get('context','default');var label=attributes.get('value','');attributes.remove('context').remove('value');if(!attributes.hasClass(['btn-default','btn-primary','btn-success','btn-info','btn-warning','btn-danger','btn-link']))attributes.addClass('btn-'+Bootstrap.checkPlain(context));if(!attributes.exists('type'))attributes.set('type',attributes.hasClass('form-submit')?'submit':'button');return '<button'+attributes+'>'+label+'</button>';},btn:function(attributes){return Drupal.theme('button',attributes);},'btn-block':function(attributes){return Drupal.theme('button',Attributes.create(attributes).addClass('btn-block'));},'btn-lg':function(attributes){return Drupal.theme('button',Attributes.create(attributes).addClass('btn-lg'));},'btn-sm':function(attributes){return Drupal.theme('button',Attributes.create(attributes).addClass('btn-sm'));},'btn-xs':function(attributes){return Drupal.theme('button',Attributes.create(attributes).addClass('btn-xs'));},bootstrapIcon:function(name,attributes){return Drupal.theme('icon','bootstrap',name,attributes);}});})(window.jQuery,window.Drupal,window.Drupal.bootstrap,window.Attributes);;
(function(Drupal,drupalSettings){Drupal.behaviors.activeLinks={attach(context){const path=drupalSettings.path;const queryString=JSON.stringify(path.currentQuery);const querySelector=path.currentQuery?`[data-drupal-link-query='${queryString}']`:':not([data-drupal-link-query])';const originalSelectors=[`[data-drupal-link-system-path="${path.currentPath}"]`];let selectors;if(path.isFront)originalSelectors.push('[data-drupal-link-system-path="<front>"]');selectors=[].concat(originalSelectors.map((selector)=>`${selector}:not([hreflang])`),originalSelectors.map((selector)=>`${selector}[hreflang="${path.currentLanguage}"]`));selectors=selectors.map((current)=>current+querySelector);const activeLinks=context.querySelectorAll(selectors.join(','));const il=activeLinks.length;for(let i=0;i<il;i++)activeLinks[i].classList.add('is-active');},detach(context,settings,trigger){if(trigger==='unload'){const activeLinks=context.querySelectorAll('[data-drupal-link-system-path].is-active');const il=activeLinks.length;for(let i=0;i<il;i++)activeLinks[i].classList.remove('is-active');}}};})(Drupal,drupalSettings);;
(function($,Drupal){'use strict';var imce=window.imce={conf:{},local:{},events:{},shortcuts:{fm:{},tree:{},content:{}},toolbarButtons:{},tree:{},selection:[],messageQueue:[],sorters:{}};$(function(){var settings=window.drupalSettings;var conf=settings&&settings.imce;var body=document.body;if(conf&&!imce.activeFolder&&$(body).hasClass('imce-page')){if(!conf.ajax_url)conf.ajax_url=Drupal.url(settings.path.currentPath);imce.init(conf,body);}});imce.init=function(conf,parentEl){conf=$.extend(imce.conf,conf);if(!conf.ajax_url||!conf.folders||!conf.root_url)return;imce.parentEl=parentEl;try{$.extend(imce.local,JSON.parse(localStorage.getItem('imce.local')));}catch(err){imce.delayError(err);}imce.trigger('preinit');imce.checkIntegration();imce.initUI();imce.initTree();imce.addShortcut('ENTER',imce.eTreeEnter,'tree');imce.addShortcut('UP',imce.eTreeUp,'tree');imce.addShortcut('DOWN',imce.eTreeDown,'tree');imce.addShortcut('LEFT',imce.eTreeLR,'tree');imce.addShortcut('RIGHT',imce.eTreeLR,'tree');imce.addShortcut('ENTER',imce.eContentEnter,'content');imce.addShortcut('UP',imce.eContentArrow,'content');imce.addShortcut('DOWN',imce.eContentArrow,'content');imce.addShortcut('LEFT',imce.eContentArrow,'content');imce.addShortcut('RIGHT',imce.eContentArrow,'content');imce.addShortcut('Ctrl+A',imce.eContentCtrlA,'content');imce.addTbb('refresh',{title:Drupal.t('Refresh'),permission:'browse_files|browse_subfolders',handler:imce.eFmRefresh,shortcut:'F5',icon:'refresh'});imce.bind('activateFolder',imce.defaultActivateFolder);imce.trigger('init');imce.createSendtoTbb();parentEl.appendChild(imce.fmEl);$(window).on('beforeunload',imce.eWinBeforeunload).on('resize',imce.eWinResize);imce.eWinResize();imce.contentEl.focus();imce.ajaxProcessMessages(conf);var path=conf.active_path;var Folder=path&&imce.addFolder(path);if(!Folder)for(path in conf.folders)if(Folder=imce.getFolder(path))break;if(Folder)Folder.open();imce.trigger('postinit');};imce.initUI=function(){var el=imce.fmEl;var createEl=imce.createEl;if(el)return el;el=imce.fmEl=createEl('<div id="imce-fm"></div>');el.onkeydown=imce.eFmKeydown;el.tabIndex=0;el.appendChild(imce.toolbarEl=createEl('<div id="imce-toolbar" aria-label="Operations" role="toolbar"></div>'));el.appendChild(imce.bodyEl=createEl('<div id="imce-body"></div>'));el=imce.treeEl=createEl('<div id="imce-tree"></div>');el.onkeydown=imce.eTreeKeydown;el.onmousedown=imce.eTreeMousedown;el.ontouchstart=imce.eTreeTouchstart;el.tabIndex=0;imce.bodyEl.appendChild(el);el=imce.treeResizerEl=createEl('<div id="imce-tree-resizer"></div>');el.onmousedown=imce.eTreeResizerMousedown;el.ontouchstart=imce.eTreeResizerTouchstart;imce.bodyEl.appendChild(el);el=imce.contentEl=createEl('<div id="imce-content"></div>');if(imce.conf.thumbnail_grid_style)el.className='thumbnail-grid';el.onmousedown=imce.eContentMousedown;el.ontouchstart=imce.eContentTouchstart;el.onkeydown=imce.eContentKeydown;el.onscroll=imce.eContentScroll;el.tabIndex=0;imce.bodyEl.appendChild(el);el=imce.contentHeaderEl=imce.createEl('<div class="imce-content-header"><div class="imce-item"><div class="imce-item-date" data-sort="date">'+Drupal.t('Date')+'</div><div class="imce-item-height" data-sort="height">'+Drupal.t('Height')+'</div><div class="imce-item-width" data-sort="width">'+Drupal.t('Width')+'</div><div class="imce-item-size" data-sort="size">'+Drupal.t('Size')+'</div><div class="imce-item-icon imce-ficon" data-sort="ext"></div><div class="imce-item-name" data-sort="name">'+Drupal.t('Name')+'</div></div></div>');el.onclick=imce.eContentHeaderClick;imce.contentEl.appendChild(el);el=imce.contentStatusEl=imce.createEl('<div class="imce-content-status"></div>');imce.contentEl.appendChild(el);el=imce.bodyResizerEl=createEl('<div id="imce-body-resizer"></div>');el.onmousedown=imce.eBodyResizerMousedown;el.ontouchstart=imce.eBodyResizerTouchstart;imce.fmEl.appendChild(el);imce.fmEl.appendChild(imce.previewEl=createEl('<div id="imce-preview"></div>'));return el;};imce.initTree=function(){var path;var folders=imce.getConf('folders');var scheme=imce.getConf('scheme');var root=new imce.Folder(scheme?scheme+'://':'<'+Drupal.t('root')+'>');root.setPath('.');root.branchEl.className+=' root';imce.treeEl.appendChild(root.branchEl);var paths=[];for(path in folders)if(imce.owns(folders,path))paths.push(path);paths.sort();for(var i=0;path=paths[i];i++)imce.addFolder(path,folders[path]);};imce.getFolder=function(path){if(imce.owns(imce.tree,path))return imce.tree[path];};imce.getItem=function(path){var Folder;var parts=imce.splitPath(path);if(parts)if(Folder=imce.getFolder(parts[0]))return Folder.getItem(parts[1]);};imce.addFolder=function(path,conf){var parts;var parent;var Folder=imce.getFolder(path);if(Folder){if(conf)Folder.setConf(conf);return Folder;}if(parts=imce.splitPath(path))if(parent=imce.addFolder(parts[0])){Folder=new imce.Folder(parts[1],conf);parent.appendItem(Folder);return Folder;}};imce.addTbb=function(id,opt){return imce.getTbb(id)||new imce.Tbb(id,opt);};imce.getTbb=function(id){return imce.toolbarButtons[id];};imce.getConf=function(name,defaultValue){var value;var conf=imce.conf;if(!name)return conf;value=conf[name];return value==null?defaultValue:value;};imce.getSelection=function(){return imce.selection.slice(0);};imce.countSelection=function(){return this.selection.length;};imce.groupSelection=function(){return imce.groupItems(imce.selection);};imce.selectAll=function(){var Folder=imce.activeFolder;if(Folder)Folder.selectAll();};imce.deselectAll=function(){var i;var arr=imce.getSelection();for(i in arr)if(imce.owns(arr,i))arr[i].deselect();};imce.getLastSelected=function(){var arr=imce.selection;var len=arr.length;if(len)return arr[len-1];};imce.selectItem=function(Item){if(!Item.selected){var arr=imce.selection;var oldlen=arr.length;arr.push(Item);Item.setState('selected');if(oldlen<2)imce.updatePreview();}};imce.deselectItem=function(Item){if(Item.selected){var arr=imce.selection;var i=$.inArray(Item,arr);Item.unsetState('selected');if(i!==-1){arr.splice(i,1);if(arr.length<2)imce.updatePreview();}}};imce.loadItemUuids=function(items,callback){var i;var Item;var missing=[];var loaded=[];for(i in items){Item=items[i];if(Item&&Item.isFile)if(Item.uuid)loaded.push(Item);else missing.push(Item);}if(!missing.length){if(callback)callback(loaded);return loaded;}return imce.ajaxItems('uuid',missing,{customComplete:function(xhr,status){var path;var Item;var response=this.response;if(response&&response.uuids)for(path in response.uuids)if(Item=imce.getItem(path)){Item.uuid=response.uuids[path];loaded.push(Item);}if(callback)callback(loaded);}});};imce.itemsHtml=function(items,type,innerHtml,separator){const lines=[];const isImg=type==='image';for(const File of items)if(isImg&&File.isImageSource())lines.push('<img src="'+File.getUrl()+'"'+(File.width?' width="'+File.width+'"':'')+(File.height?' height="'+File.height+'"':'')+' data-entity-type="file" data-entity-uuid="'+(File.uuid||'')+'" alt="" />');else{const text=(!lines.length&&innerHtml)||File.formatName();lines.push('<a href="'+File.getUrl()+'">'+text+'</a>');}return lines.join(separator==null?'<br />':separator);};imce.checkIntegration=function(){var query=imce.getQuery();var handler;var urlField;var parentWin=window.opener||window.parent;if(imce.parentWin=parentWin){if(handler=imce.resolveHandler(query.sendto,parentWin))imce.sendtoHandler=handler;else{if(urlField=query.urlField)if(urlField=parentWin.document.getElementById(urlField))imce.sendtoHandler=function(Item,win){try{imce.parentWin.focus();(imce.parentWin.jQuery||$)(urlField).val(Item.getUrl()).trigger('blur').trigger('change').trigger('focus');}catch(err){imce.delayError(err);}win.close();};}if(handler=imce.resolveHandler(query.oninit,parentWin))imce.bind('init',handler);if(imce.sendtoHandler&&query.type)imce.sendtoType=query.type;}};imce.createSendtoTbb=function(title,desc){if(imce.sendtoHandler&&!imce.getTbb('sendto'))return imce.addTbb('sendto',{title:title||Drupal.t('Select'),tooltip:desc||Drupal.t('Use the selected file.'),handler:function(){imce.runSendtoHandler();},icon:'check'});};imce.runSendtoHandler=function(items){var handler=imce.sendtoHandler;if(handler){var Item;var imgType=imce.sendtoType==='image';items=items||imce.getSelection();for(var i in items)if(imce.owns(items,i)){Item=items[i];if(imgType?Item.isImageSource():Item.isFile)return handler(Item,window);}}};imce.defaultActivateFolder=function(Folder,oldFolder){var i;var j;var Tbb;var perm;var disabled;var buttons=imce.toolbarButtons;for(i in buttons){if(!imce.owns(buttons,i))continue;Tbb=buttons[i];if(perm=Tbb.permission){perm=perm.split('|');disabled=true;for(j in perm)if(Folder.getPermission(perm[j])){disabled=false;break;}Tbb.setDisabled(disabled);}}};imce.updateHeader=function(){var newsort=imce.activeFolder.activeSort;var oldsort=imce.activeSort||{};var el=imce.contentHeaderEl;if(newsort&&(newsort.key!==oldsort.key||newsort.desc!==oldsort.desc)){if(oldsort.key)$('[data-sort="'+oldsort.key+'"]',el).removeClass('sorted '+(oldsort.desc?'desc':'asc'));$('[data-sort="'+newsort.key+'"]',el).addClass('sorted '+(newsort.desc?'desc':'asc'));imce.activeSort=newsort;}};imce.updatePreview=function(){clearTimeout(imce.previewTimer);imce.previewTimer=setTimeout(imce.doUpdatePreview,100);};imce.doUpdatePreview=function(){imce.previewItem(imce.countSelection()===1?imce.getLastSelected():null);};imce.previewItem=function(Item){var currentItem=imce.previewingItem;if(imce.previewingItem=Item){$(imce.previewEl).html(Item.createPreviewEl());imce.trigger('previewItem',Item);}else{if(currentItem)imce.previewEl.innerHTML='';}};imce.updateStatus=function(){clearTimeout(imce.statusTimer);imce.statusTimer=setTimeout(imce.doUpdateStatus,100);};imce.doUpdateStatus=function(){var Folder=imce.activeFolder;if(Folder)$(imce.contentStatusEl).html(Folder.formatStatus());};imce.getNameFilter=function(){var filters=imce.getConf('name_filters',[]);if(!imce.getConf('allow_dot_files'))filters.push('^\\.|\\.$');return filters.length?new RegExp(filters.join('|')):false;};imce.groupItems=function(items){var i;var Item;var path;var selected;var key;var names;var group={};for(i in items){if(!imce.owns(items,i))continue;Item=items[i];path=Item.parent.getPath();selected=group[path]=imce.owns(group,path)?group[path]:{};key=Item.isFolder?'subfolders':'files';names=selected[key]=selected[key]||{};names[Item.name]=Item;}return group;};imce.validatePermissions=function(items,filePerm,subfolderPerm){var path;var Folder;var selected;var groups=imce.groupItems(items);for(path in groups){if(!imce.owns(groups,path))continue;Folder=imce.getFolder(path);selected=groups[path];if(selected.files&&(filePerm==null||!Folder.getPermission(filePerm)))return false;if(selected.subfolders&&(subfolderPerm==null||!Folder.getPermission(subfolderPerm)))return false;}return true;};imce.validatePredefinedPath=function(items){var i;var Item;var Folder;for(i in items){if(!imce.owns(items,i))continue;Item=items[i];if(Item.isFolder)if(Folder=Item.hasPredefinedPath()){imce.setMessage(Drupal.t('%path is a predefined path and can not be modified.',{'%path':Folder.getPath()}));return false;}}return true;};imce.validateCount=function(items){if(!items.length){imce.setMessage(Drupal.t('Please select a file.'));return false;}return true;};imce.validateExtensions=function(items,exts){for(var i in items)if(imce.owns(items,i)&&!imce.validateExtension(items[i].ext,exts))return false;return true;};imce.validateExtension=function(ext,exts){if(!ext||$.inArray(ext.toLowerCase(),exts.toLowerCase().split(/[\s,]+/))===-1){imce.setMessage(Drupal.t('Only files with the following extensions are allowed: %files-allowed.',{'%files-allowed':exts}));return false;}return true;};imce.validateFileName=function(name){if(!name||name==='.'||name==='..'||!name.length||name.length>240)return false;var regex=imce.getNameFilter();if(regex&&regex.test(name)){imce.setMessage(Drupal.t('%filename is not allowed.',{'%filename':name}));return false;}if(/^\s|\s$|[\/\\:\*\?\x22<>\|\x00-\x1F]/.test(name)){imce.setMessage(Drupal.t('%filename contains invalid characters. Use only alphanumeric characters for better portability.',{'%filename':name}));return false;}return true;};imce.validateDimensions=function(items,width,height){if(width<1||height<1)return false;var maxwidth=imce.getConf('maxwidth');var maxheight=imce.getConf('maxheight');if(maxwidth&&width>maxwidth||maxheight&&height>maxheight){imce.setMessage(Drupal.t('Image dimensions must be smaller than %dimensions pixels.',{'%dimensions':maxwidth+'x'+maxwidth}));return false;}return true;};imce.validateImageTypes=function(items){var Item=imce.getFirstItem(items,'width',false);if(Item){imce.setMessage(Drupal.t('%name is not an image.',{'%name':Item.name}));return false;}return true;};imce.eFmKeydown=function(event){return imce.eFireShortcut.call(this,event);};imce.eFmRefresh=function(){imce.activeFolder.load();};imce.eTreeMousedown=function(event){this.focus();};imce.eTreeTouchstart=function(event){this.focus();};imce.eTreeKeydown=function(event){return imce.eFireShortcut.call(this,event,'tree');};imce.eTreeEnter=function(){imce.activeFolder.open();};imce.eTreeUp=function(e){var Folder=imce.activeFolder;var prvEl;var prvFolder;if(prvEl=Folder.branchEl.previousSibling){if(prvFolder=prvEl.Folder)while(prvFolder.expanded)if(prvEl=prvFolder.subtreeEl.lastChild)prvFolder=prvEl.Folder;}else prvFolder=Folder.parent;if(prvFolder){prvFolder.activate();imce.scrollToEl(prvFolder.branchEl,imce.treeEl);}};imce.eTreeDown=function(e){var Folder=imce.activeFolder;var nextEl;var nextFolder;if(Folder.expanded&&(nextEl=Folder.subtreeEl.firstChild))nextFolder=nextEl.Folder;else{do if(nextEl=Folder.branchEl.nextSibling){nextFolder=nextEl.Folder;break;}while(Folder=Folder.parent);}if(nextFolder){nextFolder.activate();imce.scrollToEl(nextFolder.branchEl,imce.treeEl);}};imce.eTreeLR=function(e){var Folder=imce.activeFolder;if(e.keyCode===39^Folder.expanded)$(Folder.branchToggleEl).trigger('click');};imce.eTreeResizerMousedown=function(event){return imce.eTreeResizerDown.call(this,imce.eFix(event));};imce.eTreeResizerTouchstart=function(event){return imce.eCommonTouchstart(event,imce.eTreeResizerDown,this);};imce.eTreeResizerDown=function(e,isTouch){this.startX=e.pageX;this.startW=$(imce.treeEl).width();this.maxW=this.startW+$(imce.contentEl).width();imce.bindDragDrop(imce.eTreeResizerDrag,null,null,isTouch);return false;};imce.eTreeResizerDrag=function(e){var el=imce.treeResizerEl;$(imce.treeEl).width(Math.min(el.maxW,Math.max(el.startW+e.pageX-el.startX,0)));e.preventDefault();};imce.eContentMousedown=function(event){this.focus();};imce.eContentTouchstart=function(event){this.focus();};imce.eContentKeydown=function(event){return imce.eFireShortcut.call(this,event,'content');};imce.eContentScroll=function(event){imce.updateContentPositions();setTimeout(imce.updateContentPositions);};imce.eContentHeaderClick=function(event){var key;var e=imce.eFix(event);var Folder=imce.activeFolder;var sort=Folder.activeSort||{};if(key=e.target.getAttribute('data-sort'))Folder.sortItems(key,key===sort.key?!sort.desc:sort.desc);};imce.updateContentPositions=function(){var top=imce.contentEl.scrollTop;imce.contentHeaderEl.style.top=top+'px';imce.contentStatusEl.style.bottom=-top+'px';};imce.eContentEnter=function(e){var Item=imce.getLastSelected();if(Item)Item.dblClick();};imce.eContentCtrlA=function(e){imce.selectAll();};imce.eContentArrow=function(e){var Item;var i=0;var Folder=imce.activeFolder;var key=e.keyCode;if(Item=imce.getLastSelected())i=Folder.indexOf(Item)+(key%2?key-38:imce.countElPerRow(Item.el)*(key-39));if(Item=Folder.getItemAt(i)){Item.click(e);Item.scrollIntoView();}};imce.eBodyResizerMousedown=function(event){return imce.eBodyResizerDown.call(this,imce.eFix(event));};imce.eBodyResizerTouchstart=function(event){return imce.eCommonTouchstart(event,imce.eBodyResizerDown,this);};imce.eBodyResizerDown=function(e,isTouch){this.startY=e.pageY;this.startH=$(imce.bodyEl).height();this.maxH=this.startH+$(imce.previewEl).height();imce.bindDragDrop(imce.eBodyResizerDrag,null,null,isTouch);return false;};imce.eBodyResizerDrag=function(e){var el=imce.bodyResizerEl;var bodyH=Math.min(Math.max(el.startH+e.pageY-el.startY,0),el.maxH);$(imce.bodyEl).height(bodyH);$(imce.previewEl).height(el.maxH-bodyH);e.preventDefault();};imce.eWinBeforeunload=function(e){var data={};if(data.activeSort=imce.activeSort){imce.trigger('storeLocalData',data);try{localStorage.setItem('imce.local',JSON.stringify(data));}catch(err){imce.delayError(err);}}};imce.eWinResize=function(e){var pdiff;var diff=imce.getWindowSize().height-imce.fmEl.offsetHeight;if(diff){var $bodyEl=$(imce.bodyEl);var $prvEl=$(imce.previewEl);if($prvEl[0].offsetHeight){pdiff=parseInt(diff/2);diff-=pdiff;$prvEl.height($prvEl.height()+pdiff);}$bodyEl.height($bodyEl.height()+diff);}};imce.bind=function(type,handler){var events=imce.events;var handlers=events[type];if(!handlers)handlers=events[type]={};handlers[''+handler]=handler;};imce.unbind=function(type,handler){var events=imce.events;var handlers=events[type];if(handlers)if(1 in arguments)delete handlers[''+handler];else delete events[type];};imce.trigger=function(type){var i;var handler;var handlers=imce.events[type];var ret=[];if(handlers)for(i in handlers)if(handler=handlers[i])if(handler.apply)ret.push(handler.apply(imce,Array.prototype.slice.call(arguments,1)));return ret;};imce.addShortcut=function(shortcut,handler,area){var shortcuts;if(shortcuts=imce.getAreaShortcuts(area))shortcuts[shortcut.toUpperCase()]=handler;};imce.getShortcut=function(shortcut,area){var shortcuts;if(shortcuts=imce.getAreaShortcuts(area))return shortcuts[shortcut.toUpperCase()];};imce.removeShortcut=function(shortcut,area){var shortcuts;if(shortcuts=imce.getAreaShortcuts(area))delete shortcuts[shortcut.toUpperCase()];};imce.fireShortcut=function(shortcut,area){var handler=imce.getShortcut(shortcut,area);if(handler){if(handler.click){handler.click();return true;}if(handler.apply)return handler.apply(this,Array.prototype.slice.call(arguments,2))!==false;}};imce.getAreaShortcuts=function(area){if(!area)area='fm';return imce.shortcuts[area];};imce.eBuildShortcut=function(e){var symbol;var key=e.keyCode;var shortcut='';if(key&&(symbol=imce.getKeySymbols(key))){if(e.ctrlKey)shortcut+='CTRL+';if(e.altKey)shortcut+='ALT+';if(e.shiftKey)shortcut+='SHIFT+';shortcut+=symbol;}return shortcut;};imce.eFireShortcut=function(event,area){var e=event||window.event;var shortcut=imce.eBuildShortcut(e);if(shortcut){e=$.event.fix(e);if(imce.fireShortcut.call(this,shortcut,area,e)){e.stopPropagation();return false;}}};imce.getKeySymbols=function(key){var i;var symbols=imce.keySymbols;if(!symbols){symbols=imce.keySymbols={8:'BACKSPACE',9:'TAB',13:'ENTER',27:'ESC',32:'SPACE',37:'LEFT',38:'UP',39:'RIGHT',40:'DOWN',46:'DEL'};for(i=0;i<10;i++)symbols[48+i]=''+i;for(i=65;i<91;i++)symbols[i]=String.fromCharCode(i);for(i=1;i<13;i++)symbols[111+i]='F'+i;}return (0 in arguments)?symbols[key]:symbols;};imce.ajax=function(jsop,opt){return $.ajax(imce.ajaxPrepare(jsop,opt));};imce.ajaxPrepare=function(jsop,opt){var path;var Folder=opt&&opt.activeFolder!=null?opt.activeFolder:imce.activeFolder;var data={jsop,token:imce.getConf('token')};if(Folder)if(path=Folder.getPath())data.active_path=path;return $.extend(true,imce.ajaxDefaults(),{data,activeFolder:Folder},opt);};imce.ajaxDefaults=function(){return {url:imce.getConf('ajax_url'),type:'POST',dataType:'json',beforeSend:imce.ajaxBeforeSend,success:imce.ajaxSuccess,error:imce.ajaxError,complete:imce.ajaxComplete};};imce.ajaxItems=function(jsop,items,opt){return imce.ajax(jsop,$.extend(true,imce.ajaxItemsOpt(items),opt));};imce.ajaxItemsOpt=function(items){return {data:{selection:imce.getItemPaths(items)}};};imce.ajaxBeforeSend=function(xhr,opt){var handler;var Folder;if(handler=opt.customBeforeSend)if(handler.apply(this,arguments)===false){opt.activeFolder=null;return false;}if(Folder=opt.activeFolder)Folder.setBusy(true);};imce.ajaxSuccess=function(response,status){var handler;var opt=this;opt.response=response;imce.ajaxProcessResponse(response);if(handler=opt.customSuccess)handler.apply(opt,arguments);};imce.ajaxComplete=function(xhr,status){var Folder;var handler;var opt=this;if(Folder=opt.activeFolder)Folder.setBusy(false);if(handler=opt.customComplete)handler.apply(opt,arguments);opt.response=opt.activeFolder=null;};imce.ajaxError=function(xhr,status,e){if(status!=='abort')imce.setMessage('<pre class="imce-ajax-error">'+Drupal.checkPlain(imce.ajaxErrorMessage(xhr,this.url))+'</pre>');};imce.ajaxProcessResponse=function(response){if(response){imce.ajaxProcessRemoved(response);imce.ajaxProcessAdded(response);imce.ajaxProcessMessages(response);}};imce.ajaxProcessAdded=function(response){var path;var Folder;var added;if(added=response.added)for(path in added)if(Folder=imce.addFolder(path)){Folder.addContent(added[path],true);imce.contentEl.focus();}};imce.ajaxProcessRemoved=function(response){var i;var Item;var paths=response.removed;if(paths)for(i in paths)if(Item=imce.getItem(paths[i]))Item.remove();};imce.ajaxProcessMessages=function(response){var i;var type;var msgs=response.messages;if(msgs)for(type in msgs)if(imce.owns(msgs,type))for(i in msgs[type])if(msgs[type].hasOwnProperty(i))imce.setMessage(msgs[type][i],type);};imce.ajaxErrorMessage=function(xhr,url){var msg=Drupal.t('An AJAX HTTP error occurred.');msg+='\n'+Drupal.t('Path: !uri',{'!uri':url});msg+='\n'+Drupal.t('HTTP Result Code: !status',{'!status':xhr.status||0});msg+='\n'+Drupal.t('StatusText: !statusText',{'!statusText':xhr.statusText||'N/A'});msg+='\n'+Drupal.t('ResponseText: !responseText',{'!responseText':xhr.responseText||'N/A'});return msg;};imce.getItemPaths=function(items){return $.map(items,imce.getItemPath);};imce.getItemPath=function(Item){return Item.getPath();};imce.setMessage=function(msg,type){if(!type)type='error';var mq=imce.messageQueue;var len=mq.length;var msgId=msg+':'+type;if(len&&mq[len-1].msgId===msgId)return false;mq[len]=imce.createMessageEl(msg,type);mq[len].msgId=msgId;if(!imce.pmqScheduled)imce.pmqScheduled=setTimeout(imce.processMessageQueue,100);return false;};imce.processMessageQueue=function(){var mq=imce.messageQueue;if(mq.length){$(imce.createMessagePopupEl()).html(mq).fadeIn(200);mq.length=0;$(document).on('mousedown',imce.eMPopDocMousedown);imce.mPopCloseTimer=setTimeout(imce.mPopClose,2500);}};imce.mPopClose=function(){if(imce.mPopHovering){imce.mPopCloseTimerUp=1;return imce.mPopCloseTimerUp;}clearTimeout(imce.mPopCloseTimer);imce.mPopCloseTimerUp=0;$(document).off('mousedown',imce.eMPopDocMousedown);$(imce.messagePopupEl).fadeOut(400,imce.processMessageQueueNext);};imce.processMessageQueueNext=function(){imce.pmqScheduled=0;if(imce.messageQueue.length)imce.pmqScheduled=setTimeout(imce.processMessageQueue,250);};imce.eMPopMouseenter=function(e){imce.mPopHovering=1;if(imce.mPopCloseTimerUp)clearTimeout(imce.mPopCloseTimer);};imce.eMPopMouseleave=function(e){imce.mPopHovering=0;if(imce.mPopCloseTimerUp)imce.mPopCloseTimer=setTimeout(imce.mPopClose,2000);};imce.eMPopDocMousedown=function(e){if(!imce.mPopHovering)imce.mPopClose();};imce.createMessageEl=function(msg,type){var el=imce.createEl('<div class="imce-message imce-ficon"><div class="imce-message-content"></div></div>');el.className+=' '+type;el.firstChild.innerHTML=msg;return el;};imce.createMessagePopupEl=function(){var el=imce.messagePopupEl;if(!el){el=imce.messagePopupEl=imce.createLayer('imce-message-popup',imce.fmEl);$(el).on('mouseenter',imce.eMPopMouseenter).on('mouseleave',imce.eMPopMouseleave);}return el;};imce.permissionInFolderConf=function(permission,folderConf){var permissions=folderConf&&folderConf.permissions;return !!(permissions&&((permission in permissions)?permissions[permission]:permissions.all));};imce.hasPermission=function(permission,conf){var i;var folders=(conf||imce.conf).folders;if(folders)for(i in folders)if(imce.permissionInFolderConf(permission,folders[i]))return true;return false;};imce.sortText=function(a,b){return a.toLowerCase()<b.toLowerCase()?-1:1;};imce.sortNum=function(a,b){return (a||0)-(b||0);};imce.sortNumericProperty=function(a,b,prop){var result=(a.isFolder?-1:1);if(a.isFolder===b.isFolder)result=imce.sortNum(a[prop]||0,b[prop]||0);return result;};imce.sortBranchName=function(a,b){return imce.sortText(a.name,b.name);};imce.sorters.name=function(a,b){var result=(a.isFolder?-1:1);if(a.isFolder===b.isFolder)result=imce.sortText(a.name,b.name);return result;};imce.sorters.date=function(a,b){return imce.sortNumericProperty(a,b,'date');};imce.sorters.size=function(a,b){return imce.sortNumericProperty(a,b,'size');};imce.sorters.width=function(a,b){return imce.sortNumericProperty(a,b,'width');};imce.sorters.height=function(a,b){return imce.sortNumericProperty(a,b,'height');};imce.sorters.ext=function(a,b){var result=(a.isFolder?-1:1);if(a.isFolder===b.isFolder)result=(a.isFolder?0:imce.sortText(a.ext||'',b.ext||''));return result;};imce.splitPath=function(path){if(typeof path==='string'&&path!==''){var parts=path.split('/');var filename=parts.pop();var dirpath=parts.join('/');if(filename!=='')return [dirpath===''?'.':dirpath,filename];}};imce.joinPaths=function(dirpath,filename){if(dirpath==='.')return filename;if(filename==='.')return dirpath;if(dirpath.substring(dirpath.length-1)!=='/')dirpath+='/';return dirpath+filename;};imce.getQuery=function(name){var i;var part;var parts;var str;var query=imce.query;if(!query){query=imce.query={};if(str=location.search){parts=str.substring(1).split('&');for(i in parts)if(imce.owns(parts,i)){part=parts[i].split('=');query[imce.decode(part[0])]=part[1]?imce.decode(part[1]):'';}}}return name?query[name]:query;};imce.decode=function(str){try{str=decodeURIComponent(str);}catch(err){imce.delayError(err);}return str;};imce.delayError=function(err){setTimeout(function(){throw err;});};imce.formatDate=function(timestamp,dayOnly){var D;var p0;var ret='';if(timestamp){D=new Date(timestamp*1000);p0=imce.prependZero;ret=D.getFullYear()+'-'+p0(D.getMonth()+1)+'-'+p0(D.getDate());if(!dayOnly)ret+=' '+p0(D.getHours())+':'+p0(D.getMinutes());}return ret;};imce.formatSize=function(size){if(size==null)return '';if(!size||size<100)return Drupal.formatPlural(size,'1 byte','@count bytes',{'@count':size||0});if(size<1048576)return Drupal.t('@size KB',{'@size':imce.round(size/1024,1)});return Drupal.t('@size MB',{'@size':imce.round(size/1048576,1)});};imce.formatItemsStatus=function(count,size){return Drupal.t('!items (!size)',{'!items':Drupal.formatPlural(count,'1 item','@count items'),'!size':imce.formatSize(size)});};imce.prependZero=function(num){return num<10?'0'+num:num;};imce.round=function(num,precision){var n=Math.pow(10,precision);return Math.round(num*n)/n;};imce.getExt=function(name){var pos=name.lastIndexOf('.');return pos===-1?'':name.substring(pos+1);};imce.owns=function(object,property){return Object.prototype.hasOwnProperty.call(object,property);};imce.getFirstItem=function(items,prop,state){var i;var item;if(typeof state==="undefined")state=true;for(i in items)if(imce.owns(items,i)){item=items[i];if(!prop||(item[prop]?state:!state))return item;}};imce.resolveHandler=function(str,scope){if(!str)return;var i;var obj=scope||window;var parts=str.split('.');var len=parts.length;for(i=0;i<len&&(obj=obj[parts[i]]);i++){}return i===len&&obj&&obj.call&&obj.apply?obj:false;};imce.createEl=function(html){var el;var div=imce._div;if(!div)div=imce._div=document.createElement('div');div.innerHTML=html;el=div.firstChild;div.removeChild(el);return el;};imce.createLayer=function(cname,parent){var layer=imce.createEl('<div class="imce-layer"></div>');if(cname)layer.className+=' '+cname;if(parent!==false)(parent||document.body).appendChild(layer);return layer;};imce.removeEl=function(el){var parent=el.parentNode;if(parent)parent.removeChild(el);};imce.getWindowSize=function(){return {width:window.innerWidth||document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight};};imce.getWindowScroll=function(){if(typeof window.pageXOffset==="undefined"){var el=document.documentElement;return {left:el.scrollLeft,top:el.scrollTop};}return {left:window.pageXOffset,top:window.pageYOffset};};imce.eFix=function(event){return $.event.fix(event||window.event);};imce.scrollToEl=function(el,wrpEl,diffTop,diffBottom){if(el.offsetWidth&&wrpEl.scrollHeight>wrpEl.clientHeight){var elTop=$(el).offset().top;var elBottom=elTop+el.offsetHeight;var wrpTop=$(wrpEl).offset().top;var wrpBottom=wrpTop+wrpEl.offsetHeight;wrpTop+=diffTop||0;wrpBottom-=diffBottom||0;if(elTop<wrpTop)wrpEl.scrollTop-=wrpTop-elTop+10;else{if(wrpBottom<elBottom)wrpEl.scrollTop+=Math.min(elBottom-wrpBottom+10,elTop-wrpTop-10);}}};imce.countElPerRow=function(el){return Math.max(1,parseInt(el.parentNode.clientWidth/$(el).outerWidth(true)));};imce.fixPosition=function(el){var pos=$(el).offset();var winSize=imce.getWindowSize();var winScroll=imce.getWindowScroll();var scrollbar=18;var extraX=pos.left-winScroll.left+el.offsetWidth-winSize.width+scrollbar;var extraY=pos.top-winScroll.top+el.offsetHeight-winSize.height+scrollbar;if(extraX>0)el.style.left=Math.max(0,pos.left-extraX)+'px';if(extraY>0)el.style.top=Math.max(0,pos.top-extraY)+'px';};imce.bindDragDrop=function(drag,drop,data,isTouch){var edata={drag,drop,data,isTouch};$(document).on(isTouch?'touchmove':'mousemove',edata,imce.eDocDrag).on(isTouch?'touchend':'mouseup',edata,imce.eDocDrop);};imce.eDocDrag=function(e){var edata=e.data;if(edata.drag){if(edata.isTouch)e=imce.eTouchFix(e,e.originalEvent.changedTouches[0]);return edata.drag.call(this,e);}};imce.eDocDrop=function(e){var edata=e.data;$(document).off(edata.isTouch?'touchmove':'mousemove',imce.eDocDrag).off(edata.isTouch?'touchend':'mouseup',imce.eDocDrop);if(edata.drop){if(edata.isTouch)e=imce.eTouchFix(e,e.originalEvent.changedTouches[0]);return edata.drop.call(this,e);}};imce.eTouchFix=function(e,touch){e=$.event.fix(e);if(touch&&typeof touch.pageX!=="undefined"){e.pageX=touch.pageX;e.pageY=touch.pageY;e.clientX=touch.clientX;e.clientY=touch.clientY;}return e;};imce.eCommonTouchstart=function(event,callback,context){var touch;var touches=event.changedTouches;if(touches&&(touch=touches[0])&&!touches[1]){if(callback&&callback.call)return callback.call(context||this,imce.eTouchFix(event,touch),true);return false;}};})(jQuery,Drupal);;
(function($,Drupal,imce){'use strict';imce.Item=function(name){this.construct(name);};var Item=imce.Item.prototype;Item.construct=function(name){this.createEl();this.setName(name);};Item.createEl=function(){var el;var children;var Item=this;if(!Item.el){el=Item.el=imce.createEl('<div class="imce-item"><div class="imce-item-date"></div><div class="imce-item-height"></div><div class="imce-item-width"></div><div class="imce-item-size"></div><div class="imce-item-icon imce-ficon"></div><div class="imce-item-name"></div></div>');el.onmousedown=imce.eItemMousedown;el.ondblclick=imce.eItemDblclick;el.Item=Item;children=el.children;Item.dateEl=children[0];Item.heightEl=children[1];Item.widthEl=children[2];Item.sizeEl=children[3];Item.iconEl=children[4];Item.nameEl=children[5];}};Item.appendTo=function(parent){parent.appendItem(this);};Item.remove=function(shallow){if(this.parent)this.parent.removeItem(this,shallow);};Item.click=function(e){var Item=this;if(e){if(e.shiftKey){var Folder=imce.activeFolder;var lastItem=imce.getLastSelected();var start=lastItem?Folder.indexOf(lastItem):-1;var end=Folder.indexOf(Item);var step=start<end?1:-1;while(start!==end)Folder.getItemAt(start+=step).select();return;}if(e.ctrlKey)return Item.toggleSelect();}var i;var selection=imce.getSelection();for(i in selection)if(imce.owns(selection,i)&&selection[i]!==Item)selection[i].deselect();Item.select();};Item.dblClick=function(){if(imce.sendtoHandler)imce.runSendtoHandler([this]);else this.open();};Item.open=function(){var url=this.getUrl();if(url)window.open(url);};Item.select=function(){imce.selectItem(this);};Item.deselect=function(){imce.deselectItem(this);};Item.toggleSelect=function(){if(this.selected)this.deselect();else this.select();};Item.setBusy=function(state){this.toggleState('busy',!!state);};Item.setDisabled=function(state){this.toggleState('disabled',!!state);};Item.isReady=function(){return !this.disabled&&!this.busy;};Item.getPath=function(){var parent;var path=this.path;if(path)return path;if(parent=this.parent)if(path=parent.getPath())return imce.joinPaths(path,this.name);};Item.setPath=function(path){this.path=path;};Item.getUri=function(){var path=this.getPath();if(path)return imce.joinPaths(imce.getConf('root_uri','/'),path);};Item.getUrl=function(absolute,uncached){var url=this.url;if(!url){var rootUrl=imce.getConf('root_url');if(rootUrl){var path=encodeURIComponent(this.getPath()).replace(/%2F/g,'/');url=imce.joinPaths(rootUrl,path);}}if(url){if(absolute&&url.charAt(0)==='/'&&url.charAt(1)!=='/')url=location.protocol+'//'+location.host+url;if(uncached)url+=(url.indexOf('?')===-1?'?':'&')+('s'+this.size)+('d'+this.date);}return url||'';};Item.formatUri=function(){return Drupal.checkPlain(this.getUri());};Item.formatPath=function(){return Drupal.checkPlain(this.path==='.'?this.name:this.getPath());};Item.formatName=function(){return Drupal.checkPlain(this.name);};Item.formatSize=function(){return imce.formatSize(this.size);};Item.formatDate=function(dayOnly){return imce.formatDate(this.date,dayOnly);};Item.formatWidth=function(){return this.width?this.width*1+'':'';};Item.formatHeight=function(){return this.height?this.height*1+'':'';};Item.formatDimensions=function(){return this.width?this.width*1+'x'+this.height*1:'';};Item.extend=function(props){if(props)for(var i in props){if(!imce.owns(props,i))continue;this.setProperty(i,props[i]);}};Item.setProperty=function(prop,val){var oldval=this[prop];if(oldval!==val){this[prop]=val;this.triggerPropertyChange(prop,oldval);}};Item.setName=function(name){this.setProperty('name',name);};Item.triggerPropertyChange=function(prop,oldval){var method='on'+prop.charAt(0).toUpperCase()+prop.substring(1)+'Change';if(this[method]){this[method](oldval);if(this===imce.previewingItem)imce.updatePreview();}};Item.onNameChange=function(oldname){var Item=this;var name=Item.formatName();Item.nameEl.innerHTML=name;Item.nameEl.title=name;if(Item.parent)Item.parent.onItemNameChange(Item,oldname);};Item.onThumbnailChange=function(oldval){if(this.thumbnail){this.iconEl.innerHTML='<img src="'+this.thumbnail+'" alt="thumbnail">';this.iconEl.className+=' imce-item-thumbnail';}else{this.iconEl.innerHTML='';$(this.iconEl).removeClass('imce-item-thumbnail');}};Item.onSizeChange=function(oldval){var size=this.formatSize();this.sizeEl.innerHTML=size;this.sizeEl.title=size;};Item.onDateChange=function(oldval){var date=this.formatDate(true);this.dateEl.innerHTML=date;this.dateEl.title=date;};Item.onWidthChange=function(oldval){var width=this.formatWidth();this.widthEl.innerHTML=width;this.widthEl.title=width;};Item.onHeightChange=function(oldval){var height=this.formatHeight();this.heightEl.innerHTML=height;this.heightEl.title=height;};Item.createPreviewEl=function(){var el;var Item=this;var prvEl=imce.createEl('<div class="imce-item-preview"></div>');var infoEl=imce.createEl('<div class="imce-preview-info"></div>');prvEl.appendChild(infoEl);if(Item.isFolder){infoEl.appendChild(imce.createEl('<div class="path">'+Item.formatUri()+'</div>'));prvEl.className+=' folder';}else{var url=Item.getUrl(true);infoEl.appendChild(imce.createEl('<div class="url"><a href="'+url+'" target="_blank">'+url+'</a></div>'));}if(Item.size)infoEl.appendChild(imce.createEl('<div class="size">'+Item.formatSize()+'</div>'));if(Item.width)infoEl.appendChild(imce.createEl('<div class="dimensions">'+Item.formatDimensions()+'</div>'));if(Item.date)infoEl.appendChild(imce.createEl('<div class="date">'+Item.formatDate()+'</div>'));if(Item.isImageSource()&&imce.getConf('preview_images',1)){el=imce.createEl('<div class="imce-preview-image"><img src="'+Item.getUrl(false,true)+'"></div>');prvEl.appendChild(el);prvEl.className+=' image';el.firstChild.onclick=imce.ePrvImgClick;}return prvEl;};Item.setState=function(name){var el;var Item=this;if(!Item[name]){Item[name]=true;$(Item.el).addClass(name);if(el=Item.branchEl)$(el).addClass(name);}};Item.unsetState=function(name){var el;var Item=this;if(Item[name]){Item[name]=false;$(Item.el).removeClass(name);if(el=Item.branchEl)$(el).removeClass(name);}};Item.toggleState=function(name,state){if(state==null)state=!this[name];this[state?'setState':'unsetState'](name);};Item.scrollIntoView=function(){imce.scrollToEl(this.el,imce.contentEl,imce.contentHeaderEl.offsetHeight,imce.contentStatusEl.offsetHeight);};Item.isImageSource=function(){return this.width||this.ext&&this.ext.toLowerCase()==='svg';};imce.eItemMousedown=function(event){var e=imce.eFix(event);this.Item.click(e);return !(e.ctrlKey||e.shiftKey);};imce.eItemDblclick=function(event){this.Item.dblClick();return false;};imce.ePrvImgClick=function(){var Item=imce.previewingItem;if(Item)Item.dblClick();return false;};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.File=function(name){this.construct(name);};var ItemProto=imce.Item.prototype;var File=$.extend(imce.File.prototype,ItemProto);File.construct=function(name){this.isFile=true;this.type='file';ItemProto.construct.apply(this,arguments);};File.createEl=function(){if(!this.el){ItemProto.createEl.apply(this,arguments);this.el.className+=' file';}};File.onNameChange=function(oldval){ItemProto.onNameChange.apply(this,arguments);var File=this;var newext=imce.getExt(File.name);if(File.ext!==newext){if(File.ext!=null)if(File.ext)$(File.el).removeClass('file-'+File.ext.toLowerCase());if(newext)File.el.className+=' file-'+newext.toLowerCase();File.ext=newext;}};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.Folder=function(name,conf){this.construct(name,conf);};var ItemProto=imce.Item.prototype;var Folder=$.extend(imce.Folder.prototype,ItemProto);Folder.construct=function(name,conf){var Folder=this;Folder.isFolder=true;Folder.type='folder';Folder.items=[];Folder.files={};Folder.subfolders={};ItemProto.construct.apply(Folder,arguments);Folder.setConf(conf);};Folder.createEl=function(){var nameEl;var toggleEl;var branchEl;var Folder=this;if(!Folder.el){ItemProto.createEl.apply(Folder,arguments);Folder.el.className+=' folder';Folder.contentEl=imce.createEl('<div class="imce-folder-content clearfix"></div>');Folder.subtreeEl=imce.createEl('<div class="imce-subtree"></div>');branchEl=Folder.branchEl=imce.createEl('<div class="imce-branch"><span class="imce-branch-toggle"></span><span class="imce-branch-name imce-ficon"></span></div>');toggleEl=Folder.branchToggleEl=branchEl.firstChild;toggleEl.onclick=imce.eBranchToggleClick;nameEl=Folder.branchNameEl=branchEl.children[1];nameEl.onclick=imce.eBranchNameClick;branchEl.Folder=nameEl.Folder=toggleEl.Folder=Folder;}};Folder.setContent=function(content){var i;var Item;var list;var Folder=this;var items=Folder.getItems();for(i in items){if(!imce.owns(items,i))continue;Item=items[i];list=Item.isFolder?content.subfolders:content.files;if(!list||!imce.owns(list,Item.name))if(!Item.isFolder||!Item.hasPredefinedPath())Folder.removeItem(Item);}Folder.extend(content.props);Folder.addContent(content);Folder.content=content;Folder.updateSubtree();};Folder.addContent=function(content,selectNew){var Folder=this;var files=content.files;var subfolders=content.subfolders;if(!files&&!subfolders)return;Folder.addItems(files,'file');Folder.addItems(subfolders,'folder');if(Folder.active)Folder.sortItems();else Folder.needSort=1;Folder.sortTree();if(selectNew&&Folder.active){var name;var fname;var sname;imce.deselectAll();if(files)for(fname in files){if(!imce.owns(files,fname))continue;Folder.getItem(fname).select();}if(subfolders)for(sname in subfolders){if(!imce.owns(subfolders,sname))continue;Folder.getItem(sname).select();}if(name=(fname||sname))Folder.getItem(name).scrollIntoView();}};Folder.addItems=function(items,type){var Item;var name;var Type=type==='folder'?imce.Folder:imce.File;if(items)for(name in items)if(Item=this.getItem(name)){Item.extend(items[name]);this.updateStatus();}else{Item=new Type(name);Item.extend(items[name]);this.appendItem(Item);}};Folder.getItems=function(){return this.items.slice(0);};Folder.appendItem=function(Item){var Folder=this;var name=Item.name;var existing;if(!Folder.validateAppend(Item))return;Item.remove(true);if(existing=Folder.getItem(name))existing.remove();Folder.items.push(Item);Item.parent=Folder;Folder.contentEl.appendChild(Item.el);if(Item.isFolder){Folder.prepareSubtree();Folder.subtreeEl.appendChild(Item.branchEl);Folder.subfolders[name]=Item;Item.setPath((Folder.parent?Folder.path+'/':'')+Item.name);}else Folder.files[name]=Item;Folder.updateStatus();};Folder.removeItem=function(Item,shallow){var name=Item.name;var Folder=this;if(Item.parent!==Folder)return;if(!shallow)if(Item.isFolder)for(var i in Item.items){if(!imce.owns(Item.items,i))continue;Item.removeItem(Item.items[i]);}Item.deselect();Item.setBusy(false);if(Item.isFolder){if(Item.active)Folder.activate();Item.setPath(null);delete Folder.subfolders[name];imce.removeEl(Item.branchEl);Folder.updateSubtree();}else delete Folder.files[name];Folder.items.splice(Folder.indexOf(Item),1);delete Item.parent;imce.removeEl(Item.el);Folder.updateStatus();};Folder.setPath=function(newpath){var i;var Folder=this;var oldpath=Folder.path;var subfolders=Folder.subfolders;if(oldpath!==newpath)if(newpath==null){for(i in subfolders){if(!imce.owns(subfolders,i))continue;subfolders[i].setPath(null);}delete imce.tree[oldpath];delete Folder.path;}else{Folder.path=newpath;imce.tree[newpath]=Folder;Folder.setDisabled(!Folder.getConf());for(i in subfolders){if(!imce.owns(subfolders,i))continue;subfolders[i].setPath(newpath+'/'+subfolders[i].name);}Folder.updateStatus();}};Folder.getPermission=function(name){return imce.permissionInFolderConf(name,this.getConf());};Folder.getConf=function(){var conf=this.conf;var parent;if(conf)return conf;if(parent=this.parent)if(conf=parent.getConf())if(imce.permissionInFolderConf('browse_subfolders',conf))return $.extend({inherited:true},conf);};Folder.setConf=function(conf){if(this.conf!==conf){this.conf=conf;this.setDisabled(!this.getConf());}};Folder.open=function(refresh){if(refresh||!this.content)this.load();this.activate();};Folder.load=function(){if(this.isReady()){this.setLoading(true);imce.ajax('browse',{activeFolder:this,customComplete:imce.xFolderLoadComplete});}};Folder.activate=function(){var Folder=this;var oldFolder=imce.activeFolder;var parent=Folder.parent;if(!Folder.active){if(oldFolder)oldFolder.deactivate();if(Folder.needSort)Folder.sortItems();imce.activeFolder=Folder;Folder.active=true;$(Folder.branchEl).addClass('active');if(!Folder.loading)Folder.addContentToDom();Folder.setContentVisibility(true);while(parent){parent.expand();parent=parent.parent;}Folder.updateHeader();Folder.updateStatus();imce.trigger('activateFolder',Folder,oldFolder);}};Folder.deactivate=function(){var Folder=this;if(Folder.active){Folder.setContentVisibility(false);imce.deselectAll();imce.activeFolder=null;Folder.active=false;$(Folder.branchEl).removeClass('active');}};Folder.setLoading=function(state){var Folder=this;if(state){if(!Folder.loading){Folder.setBusy(true);Folder.setState('loading');if(Folder.active)imce.deselectAll();}}else{if(Folder.loading){Folder.setBusy(false);Folder.unsetState('loading');if(Folder.active)Folder.addContentToDom();}}};Folder.getItem=function(name){var Folder=this;if(imce.owns(Folder.files,name))return Folder.files[name];if(imce.owns(Folder.subfolders,name))return Folder.subfolders[name];};Folder.getItemAt=function(i){return this.items[i];};Folder.indexOf=function(Item){return $.inArray(Item,this.items);};Folder.selectAll=function(){for(var i in this.items){if(!imce.owns(this.items,i))continue;this.items[i].select();}};Folder.countItems=function(){return this.items.length;};Folder.countSubfolders=function(){var i;var count=0;for(i in this.subfolders){if(!imce.owns(this.subfolders,i))continue;count++;}return count;};Folder.onNameChange=function(oldval){ItemProto.onNameChange.apply(this,arguments);this.branchNameEl.innerHTML=Drupal.checkPlain(this.name);this.branchNameEl.title=this.name;};Folder.onItemNameChange=function(Item,oldname){var Folder=this;var name=Item.name;var group=Item.isFolder?Folder.subfolders:Folder.files;delete group[oldname];group[name]=Item;if(Item.isFolder)Item.setPath((Folder.parent?Folder.path+'/':'')+name);};Folder.dblClick=function(){this.open();};Folder.addContentToDom=function(){var el=this.contentEl;var parentEl=imce.contentEl;if(el.parentNode!==parentEl)parentEl.appendChild(el);};Folder.setContentVisibility=function(show){var el=this.contentEl;el.style.display=show?'':'none';if(el.scrollTop)el.scrollTop=0;};Folder.prepareSubtree=function(){var Folder=this;if(Folder.subtreeEl.parentNode!==Folder.branchEl){Folder.branchEl.appendChild(Folder.subtreeEl);$(Folder.branchEl).removeClass('leaf');if(!Folder.active&&imce.activeFolder){Folder.expanded=true;Folder.shrink();}else Folder.expand();}};Folder.updateSubtree=function(){if(!this.countSubfolders()){this.shrink();imce.removeEl(this.subtreeEl);$(this.branchEl).addClass('leaf');}};Folder.expand=function(){if(!this.expanded){this.expanded=true;$(this.branchEl).addClass('expanded');$(this.subtreeEl).show();}};Folder.shrink=function(){if(this.expanded){this.expanded=false;$(this.branchEl).removeClass('expanded');$(this.subtreeEl).hide();}};Folder.updateStatus=function(){if(this.active)imce.updateStatus();};Folder.updateHeader=function(){if(this.active)imce.updateHeader();};Folder.sortItems=function(key,desc){var i;var sorter;var Folder=this;var items=Folder.items;var active=Folder.activeSort||imce.activeSort||imce.local.activeSort||{};if(key==null)key=active.key||'name';if(desc==null)desc=!!active.desc;Folder.needSort=0;if(sorter=imce.sorters[key]){items.sort(sorter);if(desc)items.reverse();for(i in items){if(!imce.owns(items,i))continue;this.contentEl.appendChild(items[i].el);}Folder.activeSort={key,desc};Folder.updateHeader();}};Folder.sortTree=function(){var i;var Folder=this;var subfolders=Folder.subfolders;var arr=[];for(i in subfolders){if(!imce.owns(subfolders,i))continue;arr.push(subfolders[i]);}if(arr.length>1){arr.sort(imce.sortBranchName);for(i in arr){if(!imce.owns(arr,i))continue;Folder.subtreeEl.appendChild(arr[i].branchEl);}}};Folder.validateAppend=function(Item,copy){if(Item===this)return false;var parent=Item.parent;if(!parent)return true;if(!copy&&parent===this)return false;if(Item.isFolder)for(parent=this.parent;parent;parent=parent.parent)if(parent===Item)return false;return true;};Folder.isPredefined=function(){return !!this.conf;};Folder.hasPredefinedPath=function(){if(this.isPredefined())return this;var i;var Folder;var subfolders=this.subfolders;for(i in subfolders)if(Folder=subfolders[i].hasPredefinedPath())return Folder;return false;};Folder.formatStatus=function(){return '<div class="items">'+imce.formatItemsStatus(this.countItems(),this.getSize())+'</div>';};Folder.getSize=function(){var i;var size=0;var files=this.files;for(i in files){if(!imce.owns(files,i))continue;size+=files[i].size||0;}return size;};imce.eBranchNameClick=function(event){this.Folder.open();return false;};imce.eBranchToggleClick=function(event){var Folder=this.Folder;if(Folder.countSubfolders())if(Folder.expanded)Folder.shrink();else Folder.expand();else Folder.open();return false;};imce.xFolderLoadComplete=function(xhr,status){var content;var opt=this;var Folder=opt.activeFolder;var response=opt.response;if(response&&(content=response.content))Folder.setContent(content);Folder.setLoading(false);if(Folder.countSubfolders())Folder.expand();};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.Tbb=function(id,opt){this.construct(id,opt);};var Tbb=imce.Tbb.prototype;Tbb.construct=function(id,opt){var Tbb=imce.toolbarButtons[id]=this;Tbb.id=id;$.extend(Tbb,opt);var el=Tbb.createEl();var parent=imce.toolbarEl;if(Tbb.prepend&&parent.firstChild)parent.insertBefore(el,parent.firstChild);else parent.appendChild(el);if(Tbb.shortcut)imce.addShortcut(Tbb.shortcut,el);};Tbb.createEl=function(){var Tbb=this;var el=Tbb.el;var icon;if(!el){el=Tbb.el=imce.createEl('<span class="imce-tbb imce-ficon" role="button"><span class="imce-tbb-title"></span></span>');if(icon=Tbb.icon)el.className+=' imce-ficon-'+icon;el.className+=' imce-tbb--'+Tbb.id;el.title=(Tbb.tooltip||Tbb.title)+(Tbb.shortcut?' ('+Tbb.shortcut+')':'');el.onclick=imce.eTbbClick;el.Tbb=Tbb;el.firstChild.innerHTML=Tbb.title;}return el;};Tbb.createPopupEl=function(){var Tbb=this;var el=Tbb.popupEl;if(!el){el=Tbb.popupEl=imce.createLayer('imce-tbb-popup');el.className+=' imce-tbb-popup--'+Tbb.id;el.onkeydown=imce.eTbbPopupKeydown;el.Tbb=Tbb;if(Tbb.content)el.appendChild(Tbb.content);}return el;};Tbb.openPopup=function(autoclose){var Tbb=this;if(!Tbb.active){Tbb.createPopupEl();Tbb.setActive(true);var popupEl=Tbb.popupEl;var $el=$(Tbb.el);var css=$el.offset();css.top+=$el.outerHeight(true);$(popupEl).css(css).fadeIn();imce.fixPosition(popupEl);$('form').find('input,select,textarea').filter(':visible').eq(0).trigger('focus');if(autoclose)$(document).on('mousedown',{Tbb},imce.eTbbDocMousedown);if(Tbb.onopen)Tbb.onopen.apply(Tbb,arguments);}};Tbb.closePopup=function(){var Tbb=this;if(Tbb.popupEl&&Tbb.active){Tbb.setActive(false);$(Tbb.popupEl).hide();imce.contentEl.focus();if(Tbb.onclose)Tbb.onclose.apply(Tbb,arguments);}};Tbb.setActive=function(state){this.toggleState('active',!!state);};Tbb.setBusy=function(state){this.toggleState('busy',!!state);};Tbb.setDisabled=function(state){this.toggleState('disabled',!!state);};Tbb.toggleState=function(name,state){var Tbb=this;var oldState=Tbb[name];if(state==null)state=!oldState;if(state){if(!oldState){Tbb[name]=true;$(Tbb.el).addClass(name);}}else{if(oldState){Tbb[name]=false;$(Tbb.el).removeClass(name);}}};Tbb.click=function(event){var Tbb=this;if(!Tbb.disabled){if(Tbb.handler&&!Tbb.busy)Tbb.handler.call(Tbb,imce.eFix(event));if(Tbb.content)Tbb.openPopup(true);}};imce.eTbbClick=function(event){this.Tbb.click(event);};imce.eTbbDocMousedown=function(e){var Tbb=e.data.Tbb;var el=Tbb.popupEl;if(el!==e.target&&!$.contains(el,e.target)){Tbb.closePopup();$(document).off('mousedown',imce.eTbbDocMousedown);}};imce.eTbbPopupKeydown=function(event){var e=event||window.event;if(e.keyCode===27){this.Tbb.closePopup();return false;}};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.newfolderInit=function(){if(imce.hasPermission('create_subfolders'))imce.addTbb('newfolder',{title:Drupal.t('New folder'),permission:'create_subfolders',content:imce.createNewfolderForm(),shortcut:'Ctrl+N',icon:'folder-add'});});imce.createNewfolderForm=function(){var form=imce.newfolderForm;if(!form){form=imce.newfolderForm=imce.createEl('<form class="imce-newfolder-form"><input type="text" name="newfolder" class="imce-newfolder-input" size="16" /><button type="submit" name="op" class="imce-newfolder-button">'+Drupal.t('Create')+'</button></form>');form.elements.newfolder.placeholder=Drupal.t('Folder name');form.onsubmit=imce.eNewfolderSubmit;}return form;};imce.eNewfolderSubmit=function(){var name=this.elements.newfolder.value;if(imce.validateNewfolder(name)){imce.ajax('newfolder',{data:{newfolder:name}});imce.getTbb('newfolder').closePopup();}return false;};imce.validateNewfolder=function(name,parentFolder){if(!parentFolder)parentFolder=imce.activeFolder;if(!parentFolder.isReady()||!parentFolder.getPermission('create_subfolders')||!imce.validateFileName(name))return false;if(parentFolder.getItem(name)){imce.setMessage(Drupal.t('%filename already exists.',{'%filename':name}));return false;}return true;};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.uploadInit=function(){if(imce.hasPermission('upload_files'))imce.addTbb('upload',{title:Drupal.t('Upload'),permission:'upload_files',content:imce.createUploadForm(),shortcut:'Ctrl+Alt+U',icon:'upload'});});imce.createUploadForm=function(){var els;var el;var exts;var form=imce.uploadForm;var name='files[imce][]';if(form)return form;form=imce.uploadForm=imce.createEl('<form class="imce-upload-form" method="post" enctype="multipart/form-data" accept-charset="UTF-8">'+'<div class="imce-form-item imce-form-file">'+'<label>'+Drupal.t('File')+'</label>'+'<input type="file" name="'+name+'" class="imce-file-input" multiple />'+'</div>'+'<div class="imce-form-actions">'+'<button type="submit" name="op" class="imce-upload-button">'+Drupal.t('Upload')+'</button>'+'</div>'+'<input type="hidden" name="jsop" value="upload" />'+'<input type="hidden" name="token" />'+'</form>');form.action=imce.getConf('ajax_url');els=form.elements;els.token.value=imce.getConf('token');el=els[name];exts=imce.getConf('extensions','');if(exts!=='*')el.accept='.'+exts.replace(/\s+/g,',.');if(imce.canAjaxUpload()){imce.activeUq=new imce.UploadQueue({name,accept:el.accept});form.insertBefore(imce.activeUq.el,form.firstChild);form.className+=' uq';if(imce.getConf('upload_auto_start',1))form.className+=' auto-start';form.onsubmit=imce.eUploadQueueSubmit;}else{form.setAttribute('target','imce_upload_iframe');form.appendChild(imce.createEl('<input type="hidden" name="active_path" />'));form.appendChild(imce.createEl('<input type="hidden" name="return_html" value="1" />'));form.onsubmit=imce.eUploadIframeSubmit;}return form;};imce.eUploadQueueSubmit=function(event){imce.activeUq.start();return false;};imce.eUploadIframeSubmit=function(event){if(!imce.validateUploadForm(this))return false;imce.createUploadIframe();this.elements.active_path.value=imce.activeFolder.getPath();imce.uploadSetBusy(true);};imce.validateUploadForm=function(form){var i;var file;var input=form.elements['files[imce][]'];var files=input.files;if(files){if(!files.length)return false;for(i=0;file=files[i];i++)if(!imce.validateFileUpload(file))return false;return true;}if(input.value){file={name:input.value.split(input.value.indexOf('/')===-1?'\\':'/').pop()};return imce.validateFileUpload(file);}return false;};imce.validateFileUpload=function(file){var exts=imce.getConf('extensions','');if(exts!=='*'&&!imce.validateExtension(imce.getExt(file.name),exts))return false;var maxsize=imce.getConf('maxsize');if(maxsize&&file.size&&file.size>maxsize){imce.setMessage(Drupal.t('%filename is %filesize exceeding the maximum file size of %maxsize.',{'%filename':file.name,'%filesize':imce.formatSize(file.size),'%maxsize':imce.formatSize(maxsize)}));return false;}if(!imce.validateFileName(file.name))return false;return $.inArray(false,imce.trigger('validateFileUpload',file))===-1;};imce.createUploadIframe=function(){var el=imce.uploadIframe;if(!el){el=imce.uploadIframe=imce.createEl('<iframe name="imce_upload_iframe" class="imce-upload-iframe" style="position: absolute; top: -9999px; left: -9999px;" src="javascript: "></iframe>');document.body.appendChild(el);setTimeout(function(){el.onload=imce.eUploadIframeLoad;});}return el;};imce.eUploadIframeLoad=function(event){var text;var response;var doc;var $body;var el=this;try{doc=el.contentDocument||el.contentWindow&&el.contentWindow.document;if(doc){$body=$(doc.body);if(text=$body.find('textarea').eq(0).val())response=$.parseJSON(text);$body.empty();}}catch(err){imce.delayError(err);}imce.uploadIframeComplete(response,text);};imce.uploadIframeComplete=function(response,text){if(response){imce.ajaxProcessResponse(response);if(response.added){imce.uploadResetInput(imce.uploadForm.elements['files[imce][]']);imce.getTbb('upload').closePopup();}}else{imce.setMessage(Drupal.t('Invalid response received from the server.'));if(text)imce.setMessage('<pre>'+Drupal.checkPlain(text)+'</pre>');}imce.uploadSetBusy(false);};imce.uploadSetBusy=function(state){$('.imce-upload-button',imce.uploadForm).toggleClass('busy',state)[0].disabled=state;};imce.canAjaxUpload=function(){var support=imce.ajaxUploadSupport;if(support==null){try{support=!!(window.FormData&&(new XMLHttpRequest().upload));}catch(err){support=false;}imce.ajaxUploadSupport=support;}return support;};imce.uploadResetInput=function(input){if($(input).val('').val()){var form=document.createElement('form');var parent=input.parentNode;form.style.display='none';parent.insertBefore(form,input);form.appendChild(input);form.reset();parent.insertBefore(input,form);parent.removeChild(form);}};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.UploadQueue=function(conf){this.construct(conf);};var Uq=imce.UploadQueue.prototype;Uq.construct=function(conf){var Uq=this;Uq.items={};Uq.queue=[];Uq.conf=$.extend({name:'files[imce][]'},conf);Uq.createEl();};Uq.createEl=function(){var Uq=this;var el=Uq.el;var inputEl;var accept;if(!el){el=Uq.el=imce.createEl('<div class="imce-uq"><span class="imce-uq-button imce-ficon imce-ficon-plus"><span class="imce-uq-label">'+Drupal.t('Add file')+'</span><input type="file" class="imce-uq-input" multiple /></span><div class="imce-uq-items"></div></div>');inputEl=Uq.inputEl=el.firstChild.lastChild;inputEl.onchange=imce.eUqInputChange;if(accept=Uq.conf.accept)inputEl.accept=accept;Uq.itemsEl=el.lastChild;el.Uq=inputEl.Uq=Uq;}return el;};Uq.start=function(){var Uq=this;if(!Uq.running&&Uq.queue.length)if(Uq.next()){Uq.running=true;imce.uploadSetBusy(true);}return Uq.running;};Uq.end=function(){if(this.running){this.running=false;imce.uploadSetBusy(false);imce.getTbb('upload').closePopup();}};Uq.next=function(){var i;var Item;var queue=this.queue.slice(0);for(i=0;Item=queue[i];i++)if(Item.completed)Item.remove();else{if(Item.start())return Item;}this.end();};Uq.selectFiles=function(list){var i;var file;var Item;var ret;var path=imce.activeFolder.getPath();for(i=0;file=list[i];i++)if(imce.validateFileUpload(file)){Item=new imce.UploadQueueItem(file,path);if(this.addItem(Item)){if(!ret)ret={};ret[i]=Item.id;}else Item.remove();}return ret;};Uq.getItem=function(id){return this.items[id];};Uq.addItem=function(Item){var existing;var Uq=this;var id=Item.id;if(existing=Uq.getItem(id))existing.remove(true);Item.Uq=Uq;Uq.items[id]=Uq.queue[Uq.queue.length]=Item;Uq.itemsEl.appendChild(Item.el);return Item;};Uq.removeItem=function(Item,quick){var Uq=this;var queue=Uq.queue;var i=$.inArray(Item,queue);if(i!==-1){queue.splice(i,1);delete Uq.items[Item.id];if(quick)$(Item.el).remove();else $(Item.el).fadeOut(1000,imce.eUqItemFadeout);return Item;}};Uq.ajaxPrepare=function(Item){var i;var field;var data;var formData;var Folder;var Uq=this;var file=Item.file;var dest=Item.destination;if(!file||!dest||!(Folder=imce.getFolder(dest)))return;data=$(Uq.inputEl.form).serializeArray().concat([{name:'active_path',value:dest}],Item.formData||[]);formData=new FormData();for(i=0;field=data[i];i++)if(field.name)formData.append(field.name,field.value);formData.append(Uq.conf.name,Item.file);return $.extend(imce.ajaxDefaults(),{data:formData,processData:false,contentType:false,customBeforeSend:imce.xUqItemBeforeSend,customComplete:imce.xUqItemComplete,xhr:imce.xUqItemXhr,itemId:Item.id,activeFolder:Folder});};imce.UploadQueueItem=function(file,destination){this.construct(file,destination);};var UqItem=imce.UploadQueueItem.prototype;UqItem.construct=function(file,destination){this.file=file;this.destination=destination;this.id=imce.joinPaths(destination,file.name);this.createEl();};UqItem.createEl=function(){var cancelEl;var name;var Item=this;var el=Item.el;var file=Item.file;if(!el){name=Drupal.checkPlain(file.name);el=Item.el=imce.createEl('<div class="imce-uqi"><div class="imce-uqi-cancel"></div><div class="imce-uqi-info"><span class="imce-uqi-name" title="'+name+'">'+name+'</span><span class="imce-uqi-size">'+imce.formatSize(file.size)+'</span></div><div class="imce-uqi-progress"><div class="imce-uqi-bar"></div></div><div class="imce-uqi-percent">'+Drupal.t('!percent%',{'!percent':0})+'</div></div>');el.Item=Item;cancelEl=el.firstChild;cancelEl.onclick=imce.eUqItemCancelClick;cancelEl.onmousedown=imce.eUqItemCancelMousedown;}return el;};UqItem.remove=function(quick){var ret;var Item=this;var Uq=Item.Uq;Item.stop();if(Uq)Uq.removeItem(Item,quick);Item.Uq=Item.xhr=Item.file=Item.formData=Item.el.Item=null;return ret;};UqItem.start=function(){var opt;var Item=this;var Uq=Item.Uq;if(Uq&&!Item.active&&!Item.completed)if(opt=Uq.ajaxPrepare(Item)){Item.active=true;$(Item.el).addClass('active');Item.xhr=$.ajax(opt);Uq.activeItem=Item;return Uq.activeItem;}};UqItem.stop=function(){var Item=this;if(Item.active){Item.active=false;$(Item.el).removeClass('active');if(Item.xhr)Item.xhr.abort();Item.complete();}};UqItem.complete=function(status){var Item=this;var Uq=Item.Uq;if(!Item.completed){Item.completed=true;Item.status=status;$(Item.el).addClass(status?'success':'fail');if(status)$('.imce-uqi-percent',Item.el).html(Drupal.t('!percent%',{'!percent':100}));if(Uq&&Uq.activeItem===Item){Uq.activeItem=null;if(Uq.running)Uq.next();}Item.stop();}};UqItem.progress=function(percent){$(this.el).find('.imce-uqi-percent').text(Drupal.t('!percent%',{'!percent':percent*1})).end().find('.imce-uqi-bar').css('width',percent*1+'%');};imce.eUqInputChange=function(){this.Uq.selectFiles(this.files);imce.uploadResetInput(this);if(imce.getConf('upload_auto_start',1))$('.imce-upload-button',this.form).trigger('click');};imce.eUqItemCancelClick=function(event){var Item=$(this).closest('.imce-uqi')[0].Item;if(Item)Item.remove(true);return false;};imce.eUqItemCancelMousedown=function(event){return false;};imce.eUqItemFadeout=function(){$(this).remove();};imce.xUqItemBeforeSend=function(xhr){};imce.xUqItemXhr=function(){var id=this.itemId;var xhr=new XMLHttpRequest();xhr.upload.onprogress=function(e){var Item=imce.activeUq.getItem(id);if(Item)Item.progress(parseInt(e.loaded*100/e.total));};return xhr;};imce.xUqItemComplete=function(xhr,status){var opt=this;var Item=imce.activeUq.getItem(opt.itemId);status=!!(opt.response&&opt.response.added);if(Item)Item.complete(status);};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.deleteInit=function(){if(imce.hasPermission('delete_files')||imce.hasPermission('delete_subfolders'))imce.addTbb('delete',{title:Drupal.t('Delete'),permission:'delete_files|delete_subfolders',handler:imce.deleteSelection,shortcut:'DEL',icon:'delete'});});imce.deleteSelection=function(){var items=imce.getSelection();if(imce.validateDelete(items))if(confirm(Drupal.formatPlural(items.length,'Delete !filename?','Delete the selected @count items?',{'!filename':items[0].name})))imce.ajaxItems('delete',items);};imce.validateDelete=function(items){return imce.activeFolder.isReady()&&imce.validateCount(items)&&imce.validatePermissions(items,'delete_files','delete_subfolders')&&imce.validatePredefinedPath(items);};})(jQuery,Drupal,imce);;
(function($,Drupal,imce){'use strict';imce.bind('init',imce.resizeInit=function(){if(imce.hasPermission('resize_images'))imce.addTbb('resize',{title:Drupal.t('Resize'),permission:'resize_images',content:imce.createResizeForm(),shortcut:'Ctrl+Alt+R',icon:'image'});});imce.createResizeForm=function(){var form=imce.resizeForm;if(!form){form=imce.resizeForm=imce.createEl('<form class="imce-resize-form">'+'<div class="imce-form-item imce-resize-dimensions">'+'<input type="number" name="width" class="imce-resize-width-input" min="1" step="1" />'+'<span class="imce-resize-separator">x</span>'+'<input type="number" name="height" class="imce-resize-height-input" min="1" step="1" />'+'</div>'+'<div class="imce-form-item imce-resize-copy">'+'<label><input type="checkbox" name="copy" class="imce-resize-copy-input" />'+Drupal.t('Create a copy')+'</label>'+'</div>'+'<div class="imce-form-actions">'+'<button type="submit" name="op" class="imce-resize-button">'+Drupal.t('Resize')+'</button>'+'</div>'+'</form>');form.onsubmit=imce.eResizeSubmit;var els=form.elements;els.width.max=imce.getConf('maxwidth')||10000;els.height.max=imce.getConf('maxheight')||10000;els.width.placeholder=Drupal.t('Width');els.height.placeholder=Drupal.t('Height');els.width.onfocus=els.height.onfocus=imce.eResizeInputFocus;}return form;};imce.eResizeSubmit=function(){var data;var els=this.elements;var width=parseInt(els.width.value*1);var height=parseInt(els.height.value*1);var copy=els.copy.checked?1:0;var items=imce.getSelection();if(imce.validateResize(items,width,height,copy)){data={width,height,copy};imce.ajaxItems('resize',items,{data});imce.getTbb('resize').closePopup();}return false;};imce.validateResize=function(items,width,height,copy){return imce.activeFolder.isReady()&&imce.validateCount(items)&&imce.validateImageTypes(items)&&imce.validateDimensions(items,width,height)&&imce.validatePermissions(items,'resize_images');};imce.eResizeInputFocus=function(){var el=this;var val=el.value;setTimeout(function(){if(el===document.activeElement&&val===el.value){var ratio;var els=el.form.elements;var isWidth=els.width===el;var value=els[isWidth?'height':'width'].value*1;var Item=imce.previewingItem;if(Item&&Item.width&&value){ratio=Item.width/Item.height;el.value=Math.round(isWidth?value*ratio:value/ratio);}el=null;}});};})(jQuery,Drupal,imce);;
